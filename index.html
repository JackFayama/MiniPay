<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="theme-color" content="#111827" />
  <meta name="color-scheme" content="dark" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <link rel="icon" href="icon-192.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="icon-192.png" sizes="192x192" />
  <link rel="manifest" href="manifest.json" />
  <title>MiniPay</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body {
      margin: 0;
      padding: env(safe-area-inset-top, 0) 0 0 0;
      height: 100%;
      background-color: #111827;
      font-family: 'Helvetica', sans-serif;
      color: white;
    }
  </style>
</head>
<body class="bg-gray-900 text-white font-sans">
  <div class="max-w-sm mx-auto">
<!-- Welcome Bar -->
<div class="flex items-center justify-between px-4 pt-4">
  <!-- Clickable Welcome Bubble -->
  <a href="profile.html" class="flex items-center space-x-2 bg-[#1e5e4b] rounded-full px-3 py-2 duration-200 active:scale-95 -ml-4">
    <div class="bg-purple-600 rounded-full h-8 w-8 flex items-center justify-center text-white font-bold">J</div>
    <span class="text-sm text-white">Welcome Jacob! ðŸ‘‹</span>
  </a>
</div>

    <!-- Balance Card -->
    <div class="bg-green-600 rounded-2xl mt-4 p-4 text-white relative">
      <div class="text-sm opacity-80">Total</div>
      <div class="text-4xl font-bold" id="balance">$22,033.49</div>
      <div class="absolute top-4 right-4 flex items-center space-x-1">
        <span class="text-sm font-semibold"></span>
        <label class="inline-flex items-center cursor-pointer">
        </label>
      </div>
      
      <div class="mt-6 flex justify-between">
        <button id="addCashBtn" class="flex items-center bg-white text-green-700 font-semibold px-4 py-2 rounded-full">
          <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 5a1 1 0 00-1 1v4H5a1 1 0 000 2h4v4a1 1 0 002 0v-4h4a1 1 0 000-2h-4V6a1 1 0 00-1-1z" />
          </svg>
          Add cash
        </button>
      
        <button id="withdrawBtn" class="flex items-center bg-white text-green-700 font-semibold px-4 py-2 rounded-full">
          <svg class="w-4 h-4 mr-2 rotate-45" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 5a1 1 0 011 1v4h4a1 1 0 010 2h-4v4a1 1 0 01-2 0v-4H5a1 1 0 010-2h4V6a1 1 0 011-1z" />
          </svg>
          Withdraw
        </button>
      </div>
    </div>

   <!-- Promotion -->
<div id="promo-bar" class="rounded-xl mt-4 p-4 relative max-w-sm"
     style="height: 140px; transition: background-color 0.5s ease;">
  <div id="promo-title" class="font-bold text-lg"></div>
  <p id="promo-text" class="text-sm mt-1"></p>
  <button id="promo-btn" class="px-4 py-2 rounded-full mt-3 text-sm font-medium"></button>
</div> 

   <!-- Recent Activity Section -->
<div class="bg-gray-800 mt-4 p-4 rounded-xl relative">
  <div class="flex justify-between items-center mb-3">
    <h2 class="text-md font-semibold">Recent activity</h2>
    <button class="text-sm text-gray-400">View more</button>
  </div>

  <div id="transactionsList" class="space-y-4">
    <!-- Transactions will be populated here -->
  </div>
</div>

    <!-- Bottom Nav -->
  <div class="fixed bottom-0 left-0 right-0 bg-gray-800 text-white flex justify-around items-center py-3">
    <div class="flex flex-col items-center text-green-500">
       <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#16a34a" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M7 15h0M2 9.5h20"/></svg>
        <span class="text-xs">Wallet</span>
      </div>
     <div class="flex flex-col items-center text-white">
  <img src="send (3).svg" alt="Pay icon" class="w-6 h-6" />
  <span class="text-xs">Pay</span>
</div>
 <div class="flex flex-col items-center text-white">
   <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5.52 19c.64-2.2 1.84-3 3.22-3h6.52c1.38 0 2.58.8 3.22 3"/><circle cx="12" cy="10" r="3"/><circle cx="12" cy="12" r="10"/></svg>     
        <span class="text-xs">Profile</span>
      </div>
    </div>

    <!-- Add Money Modal -->
    <div id="addMoneyModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
      <div class="bg-gray-800 rounded-2xl p-6 w-full max-w-sm">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-semibold text-white">Add Money</h2>
          <button id="closeAddModal" class="text-gray-400 hover:text-white">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
        
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Name</label>
            <input type="text" id="addMoneyName" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-green-500" placeholder="Enter name">
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Amount ($)</label>
            <input type="number" id="addMoneyAmount" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-green-500" placeholder="0.00" step="0.01">
          </div>
          
          <button id="submitAddMoney" class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700">
            Add Money
          </button>
        </div>
      </div>
    </div>

    <!-- Withdraw Modal -->
    <div id="withdrawModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
      <div class="bg-gray-800 rounded-2xl p-6 w-full max-w-sm">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-semibold text-white">Withdraw Money</h2>
          <button id="closeWithdrawModal" class="text-gray-400 hover:text-white">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
        
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Name</label>
            <input type="text" id="withdrawName" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-green-500" placeholder="Enter name">
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Amount ($)</label>
            <input type="number" id="withdrawAmount" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-green-500" placeholder="0.00" step="0.01">
          </div>
          
          <button id="submitWithdraw" class="w-full bg-red-600 text-white py-3 rounded-lg font-semibold hover:bg-red-700">
            Withdraw Money
          </button>
        </div>
      </div>
    </div>

    <!-- Receipt Modal -->
    <div id="receiptModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
      <div class="bg-gray-900 rounded-2xl w-full max-w-sm h-[90vh] flex flex-col overflow-hidden">
        <!-- Header with close button -->
        <div class="flex justify-between items-center mb-4">
          <button id="closeReceiptModal" class="absolute top-4 left-4 z-10 text-white">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7 7-7M3 12h18"></path>
            </svg>
          </button>
        </div>
        
        <!-- Scrollable Content Area -->
        <div class="flex-1 overflow-y-auto px-4 pt-12 space-y-6">
          <div id="receiptContent" class="space-y-6 text-white">
            <!-- Receipt content will be populated here -->
          </div>
        </div>

        <!-- Fixed Bottom Buttons -->
        <div class="p-4 space-y-4 bg-gray-900">
          <button id="downloadReceiptBtn" class="w-full border border-gray-600 text-white py-3 rounded-xl flex items-center justify-center space-x-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            <span>Download Receipt</span>
          </button>
          <button id="closeReceiptModalDone" class="w-full bg-white text-gray-900 py-3 rounded-xl font-semibold">Done</button>
        </div>
      </div>
    </div>

    <script>
  const promotions = [
    {
      bgColor: '#dbeafe', // light blue
      textColor: '#1e40af', // dark blue
      title: "You're almost there!",
      text: "Get up to $0.25 back on your first add cash transaction. Earn 2% weekly on your savings",
      btnText: "Add cash",
      btnBg: '#1e40af',
      btnColor: '#fff',
    },
    {
      bgColor: '#fef3c7', // light yellow
      textColor: '#92400e', // dark orange
      title: "Boost Your Savings",
      text: "Save more with our 3% monthly interest. Start your journey now!",
      btnText: "Start saving",
      btnBg: '#92400e',
      btnColor: '#fff',
    },
    {
      bgColor: '#dcfce7', // light green
      textColor: '#166534', // dark green
      title: "Invest Smart",
      text: "Get personalized investment tips and grow your wealth safely.",
      btnText: "Learn more",
      btnBg: '#166534',
      btnColor: '#fff',
    },
    {
      bgColor: '#fee2e2', // light red
      textColor: '#991b1b', // dark red
      title: "Limited Time Offer!",
      text: "Double your rewards on all transactions this weekend only!",
      btnText: "Claim now",
      btnBg: '#991b1b',
      btnColor: '#fff',
    },
    {
      bgColor: '#e0e7ff', // light indigo
      textColor: '#3730a3', // indigo
      title: "Secure Your Account",
      text: "Enable two-factor authentication and protect your funds.",
      btnText: "Enable 2FA",
      btnBg: '#3730a3',
      btnColor: '#fff',
    },
    {
      bgColor: '#f0f9ff', // light cyan
      textColor: '#155e75', // dark cyan
      title: "Easy Transfers",
      text: "Send money instantly to friends and family with zero fees.",
      btnText: "Send now",
      btnBg: '#155e75',
      btnColor: '#fff',
    },
    {
      bgColor: '#fefce8', // light amber
      textColor: '#854d0e', // amber dark
      title: "Cashback Rewards",
      text: "Earn cashback on every purchase with our new debit card.",
      btnText: "Get card",
      btnBg: '#854d0e',
      btnColor: '#fff',
    },
    {
      bgColor: '#ede9fe', // light purple
      textColor: '#5b21b6', // purple dark
      title: "Track Your Expenses",
      text: "Use our budgeting tools to save more efficiently.",
      btnText: "Explore tools",
      btnBg: '#5b21b6',
      btnColor: '#fff',
    },
    {
      bgColor: '#f3f4f6', // light gray
      textColor: '#374151', // gray dark
      title: "Get Instant Alerts",
      text: "Stay updated with real-time notifications on your transactions.",
      btnText: "Turn on alerts",
      btnBg: '#374151',
      btnColor: '#fff',
    },
{
  bgColor: '#fef2f2',
  textColor: '#b91c1c',
  title: "Secure Your Profile",
  text: "Update your password regularly to keep your account safe.",
  btnText: "Update Now",
  btnBg: '#b91c1c',
  btnColor: '#fff',
},
{
  bgColor: '#dbeafe',
  textColor: '#2563eb',
  title: "Track Your Spending",
  text: "Use our budgeting tools to monitor your expenses efficiently.",
  btnText: "View Tools",
  btnBg: '#2563eb',
  btnColor: '#fff',
},
{
  bgColor: '#fff7ed',
  textColor: '#b45309',
  title: "Customer Support",
  text: "We're here to help you 24/7 with any questions or concerns.",
  btnText: "Contact Us",
  btnBg: '#b45309',
  btnColor: '#fff',
},
{
  bgColor: '#f0f9ff',
  textColor: '#0369a1',
  title: "Mobile App",
  text: "Manage your account on the go with our secure mobile app.",
  btnText: "Download",
  btnBg: '#0369a1',
  btnColor: '#fff',
},
{
  bgColor: '#fefce8',
  textColor: '#78350f',
  title: "Manage Notifications",
  text: "Customize alerts to stay informed without distractions.",
  btnText: "Set Preferences",
  btnBg: '#78350f',
  btnColor: '#fff',
},
{
  bgColor: '#e9f0ff',
  textColor: '#1d4ed8',
  title: "Access Reports",
  text: "Download your monthly account statements anytime.",
  btnText: "View Reports",
  btnBg: '#1d4ed8',
  btnColor: '#fff',
},
{
  bgColor: '#d1fae5',
  textColor: '#065f46',
  title: "Set Up Auto-Pay",
  text: "Simplify payments with automatic scheduling options.",
  btnText: "Set Up Now",
  btnBg: '#065f46',
  btnColor: '#fff',
},
{
  bgColor: '#fff1f2',
  textColor: '#be123c',
  title: "Security Alerts",
  text: "Receive notifications for account activity to stay informed.",
  btnText: "Manage Alerts",
  btnBg: '#be123c',
  btnColor: '#fff',
},
{
  bgColor: '#fef3c7',
  textColor: '#92400e',
  title: "Accessibility Options",
  text: "Customize your experience for better usability.",
  btnText: "Explore Settings",
  btnBg: '#92400e',
  btnColor: '#fff',
},
{
  bgColor: '#fef2f2',
  textColor: '#9b1c1c',
  title: "Privacy Settings",
  text: "Manage who can see your activity and information.",
  btnText: "Adjust Settings",
  btnBg: '#9b1c1c',
  btnColor: '#fff',
},
{
  bgColor: '#eff6ff',
  textColor: '#1e3a8a',
  title: "Feedback",
  text: "Tell us how we can improve your experience.",
  btnText: "Give Feedback",
  btnBg: '#1e3a8a',
  btnColor: '#fff',
},
{
  bgColor: '#fef9c3',
  textColor: '#a16207',
  title: "Weekly Newsletter",
  text: "Stay updated with the latest news and tips delivered to your inbox.",
  btnText: "Subscribe",
  btnBg: '#a16207',
  btnColor: '#fff',
},
{
  bgColor: '#e0f2fe',
  textColor: '#0369a1',
  title: "Account Overview",
  text: "Quickly review your account activity and balances.",
  btnText: "View Account",
  btnBg: '#0369a1',
  btnColor: '#fff',
}
  ];

  const promoBar = document.getElementById('promo-bar');
  const titleEl = document.getElementById('promo-title');
  const textEl = document.getElementById('promo-text');
  const btnEl = document.getElementById('promo-btn');

  let currentIndex = 0;

  function showPromotion(index) {
    const promo = promotions[index];
    promoBar.style.backgroundColor = promo.bgColor;
    promoBar.style.color = promo.textColor;
    titleEl.textContent = promo.title;
    textEl.textContent = promo.text;
    btnEl.textContent = promo.btnText;
    btnEl.style.backgroundColor = promo.btnBg;
    btnEl.style.color = promo.btnColor;
  }

  function nextPromotion() {
    currentIndex = (currentIndex + 1) % promotions.length;
    showPromotion(currentIndex);
  }

  // Initialize first promotion
  showPromotion(currentIndex);

  // Change promotion every 5 seconds
  setInterval(nextPromotion, 5000);

  // Transaction Management
  class TransactionManager {
    constructor() {
      this.balance = parseFloat(localStorage.getItem('balance')) || 22033.49;
      this.transactions = JSON.parse(localStorage.getItem('transactions')) || this.getDefaultTransactions();
      this.currentReceiptTransaction = null;
      this.updateBalance();
      this.renderTransactions();
    }

    getDefaultTransactions() {
      return [
        {
          id: 'tx_' + Date.now() + '_1',
          name: 'Fanaka Homes',
          amount: 2530.00,
          type: 'credit',
          timestamp: '2025-09-22T13:32:00Z'
        },
        {
          id: 'tx_' + Date.now() + '_2',
          name: 'Brigit Mukeu',
          amount: 1060.00,
          type: 'credit',
          timestamp: '2025-09-20T18:48:12Z'
        },
        {
          id: 'tx_' + Date.now() + '_3',
          name: 'Odan Pharmaceuticals',
          amount: 1914.22,
          type: 'credit',
          timestamp: '2025-09-18T11:32:00Z'
        },
        {
          id: 'tx_' + Date.now() + '_4',
          name: 'Miswalleh Hinsallah',
          amount: 190.00,
          type: 'debit',
          timestamp: '2025-09-16T22:13:32Z'
        },
        {
          id: 'tx_' + Date.now() + '_5',
          name: 'Emily Lucas',
          amount: 488.00,
          type: 'credit',
          timestamp: '2025-09-12T23:56:00Z'
        },
        {
          id: 'tx_' + Date.now() + '_6',
          name: 'Bank Card 00792',
          amount: 2830.00,
          type: 'debit',
          timestamp: '2025-09-10T14:42:00Z'
        },
        {
          id: 'tx_' + Date.now() + '_7',
          name: 'Agoda Company Pte. Ltd.',
          amount: 20.00,
          type: 'debit',
          timestamp: '2025-05-27T23:52:00Z'
        }
      ];
    }

    addTransaction(name, amount, type) {
      const transaction = {
        id: 'tx_' + Date.now(),
        name: name,
        amount: parseFloat(amount),
        type: type,
        timestamp: new Date().toISOString()
      };

      this.transactions.unshift(transaction);
      
      if (type === 'credit') {
        this.balance += parseFloat(amount);
      } else {
        this.balance -= parseFloat(amount);
      }

      this.saveData();
      this.updateBalance();
      this.renderTransactions();
      
      return transaction;
    }

    saveData() {
      localStorage.setItem('balance', this.balance.toString());
      localStorage.setItem('transactions', JSON.stringify(this.transactions));
    }

    updateBalance() {
      document.getElementById('balance').textContent = '$' + this.balance.toLocaleString('en-US', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }

    formatDateTime(isoString) {
      const options = {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        hour12: false
      };
      const date = new Date(isoString);
      return date.toLocaleString(undefined, options);
    }

    renderTransactions() {
      const container = document.getElementById('transactionsList');
      container.innerHTML = '';

      this.transactions.slice(0, 10).forEach(transaction => {
        const transactionEl = document.createElement('div');
        transactionEl.className = 'flex justify-between items-center cursor-pointer hover:bg-gray-700 p-2 rounded-lg transition-colors';
        transactionEl.onclick = () => this.showReceipt(transaction);
        
        const amountColor = transaction.type === 'credit' ? 'text-green-400' : 'text-red-400';
        const amountPrefix = transaction.type === 'credit' ? '+' : '-';
        
        transactionEl.innerHTML = `
          <div class="flex items-center space-x-3">
            <div class="bg-blue-700 p-2 rounded-full">
              <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9 7 7 0 01-9.9-9.9zM10 5a.75.75 0 01.75.75v3.5h2a.75.75 0 010 1.5H9.25A.75.75 0 018.5 10V5.75A.75.75 0 0110 5z" clip-rule="evenodd"></path>
              </svg>
            </div>
            <div>
              <div class="text-sm font-semibold">${transaction.name}</div>
              <div class="text-xs text-gray-400">${this.formatDateTime(transaction.timestamp)}</div>
            </div>
          </div>
          <div class="${amountColor} font-semibold">${amountPrefix}$${transaction.amount.toFixed(2)}</div>
        `;
        
        container.appendChild(transactionEl);
      });
    }

    showReceipt(transaction) {
      this.currentReceiptTransaction = transaction;
      const modal = document.getElementById('receiptModal');
      const content = document.getElementById('receiptContent');
      
      const amountColor = transaction.type === 'credit' ? 'text-green-400' : 'text-red-400';
      const transactionTypeText = transaction.type === 'credit' ? 'received' : 'sent';
      
      content.innerHTML = `
        <!-- Amount and Date -->
        <div>
          <p class="text-sm text-gray-400">You've ${transactionTypeText}</p>
          <div class="flex items-baseline justify-between">
            <div class="flex items-baseline space-x-2">
              <span class="${amountColor} text-3xl font-bold">${transaction.amount.toFixed(2)}</span>
              <span class="${amountColor} text-lg font-semibold">USD</span>
            </div>
            <span class="text-sm text-gray-400">(â‰ˆKsh ${(transaction.amount * 134.2).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')})</span>
          </div>
          <p class="text-sm text-gray-400 mt-1">${this.formatDateTime(transaction.timestamp)}</p>
        </div>

        <hr class="border-gray-700">

        <!-- From/To Section -->
        <div>
          <p class="text-sm text-gray-400 mb-2">${transaction.type === 'credit' ? 'From' : 'To'}</p>
          <div class="flex items-center space-x-4">
            <div class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
            </div>
            <div>
              <p class="text-base font-semibold">${transaction.name}</p>
              <div class="bg-gray-700 text-white text-sm rounded-full px-3 py-1 mt-1 inline-block">
                Transaction Completed
              </div>
            </div>
          </div>
        </div>

        <!-- Additional spacing for long receipt -->
        <div class="space-y-4">
          <div class="bg-gray-800 p-4 rounded-lg">
            <div class="text-sm text-gray-400 mb-2">Transaction Details</div>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-gray-400">Transaction ID:</span>
                <span class="font-mono text-xs">${transaction.id}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-400">Status:</span>
                <span class="text-green-400">Completed</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-400">Payment Method:</span>
                <span>MiniPay Wallet</span>
              </div>
            </div>
          </div>
        </div>
      `;
      
      modal.classList.remove('hidden');
    }

    downloadReceipt(transaction) {
      const receiptContent = this.generateReceiptHTML(transaction);
      
      // Create a new window for printing/downloading
      const printWindow = window.open('', '_blank');
      if (printWindow) {
        printWindow.document.write(receiptContent);
        printWindow.document.close();
        
        // Trigger print dialog which allows saving as PDF
        setTimeout(() => {
          printWindow.print();
        }, 500);
      }
    }

    generateReceiptHTML(transaction) {
      const amountColor = transaction.type === 'credit' ? '#10b981' : '#ef4444';
      const transactionTypeText = transaction.type === 'credit' ? 'received' : 'sent';
      const statusText = 'Transaction Completed';
      
      return `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>MiniPay Receipt</title>
          <style>
            body {
              font-family: 'Helvetica', Arial, sans-serif;
              max-width: 400px;
              margin: 0 auto;
              padding: 40px 20px;
              background: white;
              color: #333;
              line-height: 1.6;
            }
            .header {
              text-align: center;
              margin-bottom: 40px;
              border-bottom: 2px solid #e5e7eb;
              padding-bottom: 20px;
            }
            .logo {
              font-size: 24px;
              font-weight: bold;
              color: #10b981;
              margin-bottom: 10px;
            }
            .receipt-title {
              font-size: 18px;
              font-weight: 600;
              margin-bottom: 5px;
            }
            .amount-section {
              text-align: center;
              margin: 30px 0;
              padding: 20px;
              background: #f9fafb;
              border-radius: 12px;
            }
            .amount {
              font-size: 32px;
              font-weight: bold;
              color: ${amountColor};
              margin: 10px 0;
            }
            .details-section {
              margin: 30px 0;
            }
            .detail-row {
              display: flex;
              justify-content: space-between;
              margin: 15px 0;
              padding: 10px 0;
              border-bottom: 1px solid #e5e7eb;
            }
            .detail-label {
              font-weight: 600;
              color: #6b7280;
            }
            .detail-value {
              font-weight: 500;
              text-align: right;
            }
            .status-badge {
              display: inline-block;
              background: #10b981;
              color: white;
              padding: 6px 12px;
              border-radius: 20px;
              font-size: 12px;
              font-weight: 600;
            }
            .footer {
              margin-top: 50px;
              text-align: center;
              padding-top: 30px;
              border-top: 2px solid #e5e7eb;
            }
            .official-stamp {
              display: inline-block;
              border: 3px solid #10b981;
              border-radius: 50%;
              padding: 15px;
              margin: 20px 0;
              background: #ecfdf5;
            }
            .stamp-text {
              font-size: 12px;
              font-weight: bold;
              color: #10b981;
              text-align: center;
              line-height: 1.2;
            }
            .disclaimer {
              font-size: 10px;
              color: #6b7280;
              margin-top: 20px;
            }
            @media print {
              body { margin: 0; padding: 20px; }
            }
          </style>
        </head>
        <body>
          <div class="header">
            <div class="logo">MiniPay</div>
            <div class="receipt-title">Transaction Receipt</div>
            <div style="font-size: 12px; color: #6b7280;">Receipt #${transaction.id}</div>
          </div>

          <div class="amount-section">
            <div style="font-size: 14px; color: #6b7280; margin-bottom: 10px;">
              You've ${transactionTypeText}
            </div>
            <div class="amount">$${transaction.amount.toFixed(2)}</div>
            <div style="font-size: 14px; color: #6b7280;">
              â‰ˆKsh ${(transaction.amount * 134.2).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}
            </div>
          </div>

          <div class="details-section">
            <div class="detail-row">
              <span class="detail-label">${transaction.type === 'credit' ? 'From' : 'To'}:</span>
              <span class="detail-value">${transaction.name}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Date & Time:</span>
              <span class="detail-value">${this.formatDateTime(transaction.timestamp)}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Transaction ID:</span>
              <span class="detail-value" style="font-family: monospace; font-size: 11px;">${transaction.id}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Status:</span>
              <span class="detail-value"><span class="status-badge">${statusText}</span></span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Payment Method:</span>
              <span class="detail-value">MiniPay Wallet</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Reference:</span>
              <span class="detail-value">MP${Date.now().toString().slice(-8)}</span>
            </div>
          </div>

          <div class="footer">
            <div class="official-stamp">
              <div class="stamp-text">
                OFFICIAL<br>
                RECEIPT<br>
                VERIFIED
              </div>
            </div>
            <div style="font-size: 12px; font-weight: 600; margin: 10px 0;">
              This is an official receipt from MiniPay
            </div>
            <div class="disclaimer">
              This receipt serves as proof of transaction. Keep this for your records.<br>
              For support, contact: support@minipay.com | +254-700-000-000<br>
              Generated on: ${new Date().toLocaleString()}
            </div>
          </div>
        </body>
        </html>
      `;
    }
  }

  // Initialize transaction manager
  const transactionManager = new TransactionManager();

  // Modal controls
  const addMoneyModal = document.getElementById('addMoneyModal');
  const withdrawModal = document.getElementById('withdrawModal');
  const receiptModal = document.getElementById('receiptModal');

  // Add Money Modal
  document.getElementById('addCashBtn').addEventListener('click', () => {
    addMoneyModal.classList.remove('hidden');
  });

  document.getElementById('closeAddModal').addEventListener('click', () => {
    addMoneyModal.classList.add('hidden');
    document.getElementById('addMoneyName').value = '';
    document.getElementById('addMoneyAmount').value = '';
  });

  document.getElementById('submitAddMoney').addEventListener('click', () => {
    const name = document.getElementById('addMoneyName').value.trim();
    const amount = document.getElementById('addMoneyAmount').value.trim();

    if (!name || !amount || parseFloat(amount) <= 0) {
      alert('Please enter valid name and amount');
      return;
    }

    transactionManager.addTransaction(name, amount, 'credit');
    addMoneyModal.classList.add('hidden');
    document.getElementById('addMoneyName').value = '';
    document.getElementById('addMoneyAmount').value = '';
  });

  // Withdraw Modal
  document.getElementById('withdrawBtn').addEventListener('click', () => {
    withdrawModal.classList.remove('hidden');
  });

  document.getElementById('closeWithdrawModal').addEventListener('click', () => {
    withdrawModal.classList.add('hidden');
    document.getElementById('withdrawName').value = '';
    document.getElementById('withdrawAmount').value = '';
  });

  document.getElementById('submitWithdraw').addEventListener('click', () => {
    const name = document.getElementById('withdrawName').value.trim();
    const amount = document.getElementById('withdrawAmount').value.trim();

    if (!name || !amount || parseFloat(amount) <= 0) {
      alert('Please enter valid name and amount');
      return;
    }

    if (parseFloat(amount) > transactionManager.balance) {
      alert('Insufficient balance');
      return;
    }

    transactionManager.addTransaction(name, amount, 'debit');
    withdrawModal.classList.add('hidden');
    document.getElementById('withdrawName').value = '';
    document.getElementById('withdrawAmount').value = '';
  });

  // Receipt Modal
  document.getElementById('closeReceiptModal').addEventListener('click', () => {
    receiptModal.classList.add('hidden');
  });

  document.getElementById('closeReceiptModalDone').addEventListener('click', () => {
    receiptModal.classList.add('hidden');
  });

  document.getElementById('downloadReceiptBtn').addEventListener('click', () => {
    if (transactionManager.currentReceiptTransaction) {
      transactionManager.downloadReceipt(transactionManager.currentReceiptTransaction);
    }
  });

  // Close modals when clicking outside
  [addMoneyModal, withdrawModal, receiptModal].forEach(modal => {
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.classList.add('hidden');
      }
    });
  });
</script>
    
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/service-worker.js')
        .then(reg => console.log('Service Worker registered:', reg.scope))
        .catch(err => console.error('Service Worker registration failed:', err));
    });
  }
</script>
<script>
  let deferredPrompt;

  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    // Optionally show your own install button
    console.log('Install prompt saved.');

    // Trigger prompt somewhere in your UI:
    // deferredPrompt.prompt();
  });
</script>

</body>
</html>
